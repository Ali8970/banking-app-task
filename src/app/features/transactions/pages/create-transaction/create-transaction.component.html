<div class="page-container">
  <div class="page-header">
    <button type="button" class="back-link" (click)="goBack()">
      <svg class="back-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Transactions
    </button>
    <h1 class="page-title">Create Transaction</h1>
    <p class="page-subtitle">Account: {{ customerState.selectedAccount()?.accountNumber }}</p>
  </div>

  @if (customerState.selectedAccount()?.status === 'frozen') {
    <div class="warning-banner">
      <p class="warning-text"><strong>Account Frozen:</strong> Only credit transactions are allowed on this account.</p>
    </div>
  }

  <app-card>
    <form (submit)="onSubmit($event)">
      <div class="form-section">
        <label class="form-label">Transaction Type</label>
        <div class="type-grid">
          <button
            type="button"
            class="type-btn"
            [class.type-btn-active-credit]="transactionForm.type().value() === 'credit'"
            (click)="setType('credit')"
          >
            <div class="type-btn-inner">
              <div class="type-icon type-icon-credit">
                <svg class="type-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
              </div>
              <div>
                <p class="type-label">Credit</p>
                <p class="type-desc">Money in</p>
              </div>
            </div>
          </button>
          <button
            type="button"
            class="type-btn"
            [class.type-btn-active-debit]="transactionForm.type().value() === 'debit'"
            [disabled]="customerState.selectedAccount()?.status === 'frozen'"
            (click)="setType('debit')"
          >
            <div class="type-btn-inner">
              <div class="type-icon type-icon-debit">
                <svg class="type-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                </svg>
              </div>
              <div>
                <p class="type-label">Debit</p>
                <p class="type-desc">Money out</p>
              </div>
            </div>
          </button>
        </div>
      </div>

      <div class="form-field">
        <label for="amount" class="form-label">Amount</label>
        <div class="input-with-prefix">
          <span class="input-prefix">{{ currencySymbol() }}</span>
          <input id="amount" type="number" step="any" [formField]="transactionForm.amount" class="form-input" placeholder="0.00" />
        </div>
        @if (transactionForm.type().value() === 'debit') {
          <p class="form-hint">Daily limit remaining: {{ transactionService.remainingDailyLimit() | currencyFormat:customerState.selectedAccount()?.currency }}</p>
        }
        @if (transactionForm.amount().touched() && transactionForm.amount().invalid()) {
          <ul class="form-error-list">
            @for (error of transactionForm.amount().errors(); track error.kind) {
              <li class="form-error">{{ error.message }}</li>
            }
          </ul>
        }
      </div>

      <div class="form-field">
        <label for="category" class="form-label">Category</label>
        <select id="category" [formField]="transactionForm.category" class="form-select">
          <option value="">Select a category</option>
          @for (cat of availableCategories(); track cat) {
            <option [value]="cat">{{ cat | titlecase }}</option>
          }
        </select>
        @if (transactionForm.category().touched() && transactionForm.category().invalid()) {
          <ul class="form-error-list">
            @for (error of transactionForm.category().errors(); track error.kind) {
              <li class="form-error">{{ error.message }}</li>
            }
          </ul>
        }
      </div>

      <div class="form-field">
        <label for="date" class="form-label">Date</label>
        <input id="date" type="date" [formField]="transactionForm.date" class="form-input" />
        @if (isScheduled()) {
          <p class="form-hint form-hint-warning">This transaction will be scheduled for {{ transactionForm.date().value() }}</p>
        }
        @if (transactionForm.date().touched() && transactionForm.date().invalid()) {
          <ul class="form-error-list">
            @for (error of transactionForm.date().errors(); track error.kind) {
              <li class="form-error">{{ error.message }}</li>
            }
          </ul>
        }
      </div>

      <div class="form-field">
        <label for="description" class="form-label">Description</label>
        <textarea id="description" [formField]="transactionForm.description" rows="3" class="form-textarea" placeholder="Enter transaction description..."></textarea>
        @if (transactionForm.description().touched() && transactionForm.description().invalid()) {
          <ul class="form-error-list">
            @for (error of transactionForm.description().errors(); track error.kind) {
              <li class="form-error">{{ error.message }}</li>
            }
          </ul>
        }
      </div>

      @if (validationErrors().length > 0) {
        <div class="validation-errors">
          <p class="validation-errors-title">Please fix the following errors:</p>
          <ul class="validation-errors-list">
            @for (error of validationErrors(); track error.code) {
              <li>{{ error.message }}</li>
            }
          </ul>
        </div>
      }

      <div class="form-actions">
        <app-button type="submit" [loading]="isSubmitting()" [disabled]="transactionForm().invalid()">
          {{ isScheduled() ? 'Schedule Transaction' : 'Create Transaction' }}
        </app-button>
        <app-button type="button" variant="outline" (clicked)="saveDraft()">Save Draft</app-button>
        <app-button type="button" variant="ghost" (clicked)="goBack()">Cancel</app-button>
      </div>
    </form>
  </app-card>
</div>
